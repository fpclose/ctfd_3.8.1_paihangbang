# CTFd-Paihangb 插件安装指南

## 📋 概述

CTFd-Paihangb（排行榜）插件为 CTFd 3.8.1 提供了分赛道排行榜功能，支持按赛道和学校进行筛选，提供更丰富的排行榜查看体验。

### 主要特性

- ✅ **四大榜单**：总榜、新生榜、进阶榜、社会榜
- ✅ **学校信息显示**：排行榜中显示每个队伍的学校
- ✅ **赛道信息显示**：排行榜中显示每个队伍的参与赛道
- ✅ **一键切换**：快速切换不同赛道榜单
- ✅ **学校筛选**：按学校名称筛选团队
- ✅ **实时搜索**：根据队伍名称实时过滤
- ✅ **自动排名**：按分数和解题时间自动排序
- ✅ **美观界面**：渐变色设计，响应式布局，排名徽章（🥇🥈🥉）
- ✅ **自动刷新**：每30秒自动更新数据

## 🚀 快速开始

### 前置要求

⚠️ **重要**：本插件依赖以下插件，请按顺序安装：

1. **ctfd-user** - 提供用户自定义字段
   - 仓库：https://github.com/fpclose/ctfd_3.8.1_user
   
2. **ctfd-tuandui** - 提供团队赛道信息
   - 仓库：https://github.com/fpclose/ctfd_3.8.1_tuandui

### 方法一：使用安装脚本（推荐）

```bash
# 1. 下载插件
cd /opt/CTFd/CTFd/plugins
git clone https://github.com/fpclose/ctfd_3.8.1_paihangbang.git ctfd-paihangb

# 2. 运行安装脚本
cd ctfd-paihangb
chmod +x install.sh
sudo ./install.sh
```

### 方法二：手动安装

```bash
# 1. 克隆仓库到插件目录
cd /opt/CTFd/CTFd/plugins
git clone https://github.com/fpclose/ctfd_3.8.1_paihangbang.git ctfd-paihangb

# 2. 重启 CTFd
cd /opt/CTFd
docker compose restart ctfd
```

## 📊 功能展示

### 排行榜表格

```
┌──────┬────────────┬────────────┬──────────┬──────┐
│ 排名 │ 队伍名称    │ 学校       │ 赛道     │ 总分 │
├──────┼────────────┼────────────┼──────────┼──────┤
│  🥇  │ Team A     │ 北京大学   │ 新生赛道 │ 1000 │
│  🥈  │ Team B     │ 清华大学   │ 进阶赛道 │  900 │
│  🥉  │ Team C     │ 复旦大学   │ 新生赛道 │  800 │
│   4  │ Team D     │ 上海交大   │ 社会赛道 │  700 │
└──────┴────────────┴────────────┴──────────┴──────┘
```

### 特色功能

- **排名徽章**：前三名显示 🥇🥈🥉 emoji
- **赛道徽章**：不同赛道显示不同颜色的徽章
  - 新生赛道：绿色徽章
  - 进阶赛道：青色徽章
  - 社会赛道：灰色徽章
- **学校信息**：清晰显示每个队伍的学校
- **学校筛选**：下拉菜单快速筛选特定学校的队伍
- **实时搜索**：输入队伍名称即时过滤结果

## 🔧 技术实现

### API 接口

#### 获取完整排行榜数据

```http
GET /api/v1/scoreboard/data
```

**查询参数**：
- `track` (可选): 赛道筛选（新生赛道/进阶赛道/社会赛道）
- `school` (可选): 学校筛选（学校名称）

**响应示例**：
```json
{
  "success": true,
  "data": [
    {
      "rank": 1,
      "team_id": 5,
      "team_name": "Team Alpha",
      "school": "北京大学",
      "track": "新生赛道",
      "score": 1000.0
    }
  ]
}
```

#### 获取前10名排行榜数据

```http
GET /api/v1/top10/leaderboards
```

**响应示例**：
```json
{
  "success": true,
  "data": {
    "all": [...],
    "new": [...],
    "upper": [...],
    "social": [...]
  }
}
```

### 数据流程

```
用户访问页面
    ↓
JavaScript 初始化
    ↓
请求 API (/api/v1/scoreboard/data)
    ↓
后端查询数据库
    ↓
获取团队分数
    ↓
添加学校和赛道信息
    ↓
格式化为 JSON
    ↓
返回给前端
    ↓
前端渲染表格
    ↓
30秒后自动刷新
```

## 📖 使用指南

### 访问排行榜

安装后访问：

```
http://your-ctfd-url/scoreboard/custom
```

### 操作说明

#### 1. 查看总榜
- 访问排行榜页面
- 默认显示总榜
- 显示所有团队及其学校、赛道信息

#### 2. 切换赛道榜单
1. 点击顶部按钮（🎓 新生榜 / 🚀 进阶榜 / 👥 社会榜）
2. 自动筛选对应赛道的团队
3. 显示该赛道所有队伍的学校信息

#### 3. 按学校筛选
1. 点击"筛选器"展开筛选面板
2. 在"学校"下拉框选择目标学校
3. 自动显示该学校的所有队伍（保持当前赛道筛选）

#### 4. 搜索队伍
1. 在搜索框输入队伍名称关键词
2. 实时过滤显示匹配的队伍
3. 保持当前的赛道和学校筛选

#### 5. 重置筛选
1. 点击"重置"按钮
2. 清除学校筛选和搜索条件
3. 返回当前榜单的完整列表

## 🐛 故障排除

### 问题 1：学校信息未显示

**症状**：排行榜中学校列显示"未填写"

**可能原因**：
- 团队没有填写"学校名称"字段
- ctfd-tuandui 插件未正确配置

**解决方法**：
1. 确保团队已填写"学校名称"字段
2. 在 Admin → Teams → [队伍] → Fields 中检查

### 问题 2：赛道信息未显示

**症状**：赛道列显示"未分配"

**可能原因**：
- 团队没有选择"参与赛道"

**解决方法**：
1. 确保团队已选择参与赛道
2. 在 Admin → Teams → [队伍] → Fields 中检查

### 问题 3：学校筛选下拉框为空

**症状**：筛选器中的学校下拉框没有选项

**解决方法**：
1. 确保至少有一个团队填写了学校信息
2. 清除浏览器缓存并刷新
3. 检查后端日志是否有错误

## 🔄 更新日志

### v1.0.2 (2025-11-18)

- ✨ **添加学校信息显示**：排行榜中显示每个队伍的学校
- ✨ **添加赛道信息显示**：排行榜中显示每个队伍的参与赛道
- ✨ **添加学校筛选API**：支持按学校筛选排行榜数据
- 🎨 **优化表格显示**：移除解题数列，优化列宽
- 🎨 **添加排名徽章**：前三名显示金银铜牌 emoji
- 🎨 **添加赛道徽章**：不同赛道显示不同颜色
- 🐛 **修复数据获取逻辑**：优化团队自定义字段查询
- 📝 **完善文档**：更新安装指南和使用说明

### v1.0.1 (2025-11-18)

- 🐛 修复页面路由缺失
- ✨ 添加 Blueprint 注册
- 🎨 修复 Bootstrap 5 兼容性

### v1.0.0 (2025-11-16)

- ✨ 初始版本发布
- ✅ 支持四大榜单切换

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

本项目基于 MIT 许可证开源。

## 📮 联系方式

- GitHub Issues: https://github.com/fpclose/ctfd_3.8.1_paihangbang/issues
- 维护者: fpclose

---

**版本**: 1.0.2  
**兼容**: CTFd 3.8.1  
**依赖**: ctfd-user, ctfd-tuandui  
**最后更新**: 2025-11-18
